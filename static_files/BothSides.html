<!-- Skeleton HomePage -->

<!DOCTYPE html>
<html>
<script src="Javascript/jquery-3.3.1.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.11.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    // Paste Data HERE:
    apiKey: "AIzaSyBdMvbpg5HHZmCOWkoI45DF6dpEuQXLxxU",
    authDomain: "bothsides-70e83.firebaseapp.com",
    databaseURL: "https://bothsides-70e83.firebaseio.com",
    projectId: "bothsides-70e83",
    storageBucket: "bothsides-70e83.appspot.com",
    messagingSenderId: "841983833378"
  };
  firebase.initializeApp(config);
  const database = firebase.database();
  function getCnnArticles() {
    let cnnurl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=cnn&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
          // 'language=en&' +
    let req = new Request(cnnurl);
    return fetch(req).then(response => response.json());
  };
  function getFoxArticles() {
    let foxurl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=fox-news&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
          // 'language=en&' +
    let req = new Request(foxurl);
    return fetch(req).then(response => response.json());
  };
  function getBbcArticles() {
    let bbcurl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=bbc-news&' +
          // 'language=en&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
    let req = new Request(bbcurl);
    return fetch(req).then(response => response.json());
  };
  function getNYTimesArticles() {
    let nyturl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=the-new-york-times&' +
          // 'language=en&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
    let req = new Request(nyturl);
    return fetch(req).then(response => response.json());
  };
  function getBreitbartArticles() {
    let breiturl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=breitbart-news&' +
          // 'language=en&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
    let req = new Request(breiturl);
    return fetch(req).then(response => response.json());
  };
  function getBloombergArticles() {
    let bloomurl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=bloomberg&' +
          // 'language=en&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
    let req = new Request(bloomurl);
    return fetch(req).then(response => response.json());
  };
  function getUSATodayArticles() {
    let usaurl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=usa-today&' +
          // 'language=en&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
    let req = new Request(usaurl);
    return fetch(req).then(response => response.json());
  };
  function getDailyMailArticles() {
    let dailyMailurl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=daily-mail&' +
          // 'language=en&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
    let req = new Request(dailyMailurl);
    return fetch(req).then(response => response.json());
  };
  function getMsnbcArticles() {
    let msnbcurl = 'https://newsapi.org/v2/top-headlines?' +
          'sources=msnbc&' +
          // 'language=en&' +
          'apiKey=5f5292f795ff4921b8fe0f9384dd7435';
    let req = new Request(msnbcurl);
    return fetch(req).then(response => response.json());
  };
  function cleanArticleTitle(title) {
    const toCut = ['and', 'in', 'on', 'from', 'to', 'a', 'an', 'the', 'he', 'she', 'we', 'this', 'that', 'with', 'will', 'it', 'be', 'can', 'but', 'is', 'was', 'what', 'for', 'of', 'at', 'not', 'they', 'them', 'say'];
    let splitTitle = title.split(' ');
    let newTitleArr = [];
    for (i=0; i < splitTitle.length; i++) {
        if (!toCut.includes(splitTitle[i])) {
            newTitleArr.push(splitTitle[i]);
        }
    }
    return newTitleArr.join(' ');
  };
  (async function(){
    cnnArticles = await getCnnArticles();
    foxArticles = await getFoxArticles();
    bbcArticles = await getBbcArticles();
    nytArticles = await getNYTimesArticles();
    breitbartArticles = await getBreitbartArticles();
    bloombergArticles = await getBloombergArticles();
    usatodayArticles = await getUSATodayArticles();
    dailymailArticles = await getDailyMailArticles();
    msnbcArticles = await getMsnbcArticles();
    leftArticles = [cnnArticles, nytArticles, msnbcArticles];
    rightArticles = [foxArticles, breitbartArticles, dailymailArticles];
    midArticles = [bbcArticles, bloombergArticles, usatodayArticles];
    database.ref('history/left').set(leftArticles);
    database.ref('history/right').set(rightArticles);
    database.ref('history/mid').set(midArticles);
  })();
  setTimeout(function(){ 
    // console.log(cnnArticles.articles);
    // console.log(foxArticles.articles);
    // console.log(nytArticles.articles);
    // console.log(breitbartArticles.articles);
    // console.log(bbcArticles.articles);
    let displayArticles = [];
    let iframeArticles = [];
    for (curLeftSource = 0; curLeftSource < leftArticles.length; curLeftSource++) {
        for (curLeftArticle = 0; curLeftArticle < leftArticles[curLeftSource].articles.length; curLeftArticle++) {
            for (curRightSource = 0; curRightSource < rightArticles.length; curRightSource++) {
                //console.log(rightArticles[curRightSource].articles[0].source);
                for (curRightArticle = 0; curRightArticle < rightArticles[curRightSource].articles.length; curRightArticle++) {
                    let titleA = cleanArticleTitle(leftArticles[curLeftSource].articles[curLeftArticle].title.toLowerCase());
                    let titleB = cleanArticleTitle(rightArticles[curRightSource].articles[curRightArticle].title.toLowerCase());
                    let sim = findSimilarity(titleA, titleB);
                    if (sim > .12) {
                        //console.log(sim, titleA, titleB);
                        displayArticle = leftArticles[curLeftSource].articles[curLeftArticle]
                        
                        //iFrame Usage
                        iframeLeft = leftArticles[curLeftSource].articles[curLeftArticle]
                        iframeRight = rightArticles[curRightSource].articles[curRightArticle]

                        if (displayArticle.content && displayArticle.description) {
                            displayArticles.push(displayArticle);
                            iframeArticles.push(iframeLeft);
                            iframeArticles.push(iframeRight);
                        }
                        
                    }
                    if (sim > .5) {
                        // console.log(titleA);
                        // console.log(titleB);
                        // console.log('--------------------------------------');
                        for (curMidSource = 0; curMidSource < midArticles.length; curMidSource++) {
                            for (curMidArticle = 0; curMidArticle < midArticles[curMidSource].articles.length; curMidArticle++) {
                                let titleC = cleanArticleTitle(midArticles[curMidSource].articles[curMidArticle].title.toLowerCase());
                                let simAB = findSimilarity(titleA, titleC);
                                let simBC = findSimilarity(titleB, titleC);
                                if (simAB > .2 || simBC > .2) {
                                    //console.log(titleA);
                                    //console.log(titleB);
                                    //console.log(titleC);
                                    //console.log('----------------------------------');
                                    // $('#Headline1').html(titleC);
                                    // $('#desc1').html(midArticles[curMidSource].articles[curMidArticle].description);
                                    if (midArticles[curMidSource].articles[curMidArticle].content && midArticles[curMidSource].articles[curMidArticle].description) {
                                        //iframeArticles.push(midArticles[curMidSource].articles[curMidArticle]);
                                        displayArticles.push(midArticles[curMidSource].articles[curMidArticle]);
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    console.log(iframeArticles);
    //console.log(displayArticles);
    if (displayArticles.length >= 5) {
        let k = 1;
        for (i=0; i < 5; i++) {
            let headID = '#Headline' + String(i+1);
            let descID = '#desc' + String(i+1);

            let urlLeft = '#urlLeft' + String(i+1);
            let urlRight = '#urlRight' + String(i+1);

            let textLeft = '#textLeft' + String(i+1);
            let textRight = '#textRight' + String(i+1);

            // console.log(headID, descID);
            $(headID).html(displayArticles[i].title);
            $(descID).html(displayArticles[i].description);

            
            $(urlLeft).html(iframeArticles[i*2].url);
            $(urlRight).html(iframeArticles[k].url);
            
            $(textLeft).html(iframeArticles[i*2].content);
            $(textRight).html(iframeArticles[k].content);
            k = k + 2;
        }
    }
    else {
        let k = 1;
        for (i=0; i < displayArticles.length; i++) {
            headID = '#Headline' + String(i+1);
            descID = '#desc' + String(i+1);

            let urlLeft = '#urlLeft' + String(i+1);
            let urlRight = '#urlRight' + String(i+1);

            $(headID).html(displayArticles[i].title);
            $(descID).html(displayArticles[i].description);


            $(urlLeft).html(iframeArticles[i*2].url);
            $(urlRight).html(iframeArticles[k].url);

            $(textLeft).html(iframeArticles[i*2].content);
            $(textRight).html(iframeArticles[k].content);
            k = k + 2;
        }
    }
  }, 2000);
  function findSimilarity(title1, title2) {
    
    function termFreqMap(str) {
        var words = str.split(' ');
        //console.log(words);
        var termFreq = {};
        words.forEach(function(w) {
            termFreq[w] = (termFreq[w] || 0) + 1;
        });
        return termFreq;
    }
    function addKeysToDict(map, dict) {
        for (var key in map) {
            dict[key] = true;
        }
    }
    function termFreqMapToVector(map, dict) {
        var termFreqVector = [];
        for (var term in dict) {
            termFreqVector.push(map[term] || 0);
        }
        return termFreqVector;
    }
    function vecDotProduct(vecA, vecB) {
        var product = 0;
        for (var i = 0; i < vecA.length; i++) {
            product += vecA[i] * vecB[i];
        }
        return product;
    }
    function vecMagnitude(vec) {
        var sum = 0;
        for (var i = 0; i < vec.length; i++) {
            sum += vec[i] * vec[i];
        }
        return Math.sqrt(sum);
    }
    function cosineSimilarity(vecA, vecB) {
        return vecDotProduct(vecA, vecB) / (vecMagnitude(vecA) * vecMagnitude(vecB));
    }
    Cosinesimilarity = function textCosineSimilarity(strA, strB) {
        var termFreqA = termFreqMap(strA);
        var termFreqB = termFreqMap(strB);
        var dict = {};
        addKeysToDict(termFreqA, dict);
        addKeysToDict(termFreqB, dict);
        var termFreqVecA = termFreqMapToVector(termFreqA, dict);
        var termFreqVecB = termFreqMapToVector(termFreqB, dict);
        return cosineSimilarity(termFreqVecA, termFreqVecB);
    }
    return Cosinesimilarity(title1, title2);
  };
</script>
    <head>
            <title>Home - Both Sides</title>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic" rel="stylesheet">
            <link rel="stylesheet" type="text/css" href="CSS/BothSides.css">
            <link rel="stylesheet" type="text/css" href="CSS/Tile.css">
            <script src="Javascript/BothSides.js"></script>
    </head>

<script src="Javascript/jquery-3.3.1.min.js"></script>
<script type="text/javascript">
    $(document).ready(() => {

        $(".popup").hide();
        $(".close").click(function () {
            $(this).parent().fadeOut("slow");
            $(".links").fadeIn("slow");
        });

        //setTimeout(function(){console.log(cnnArticles)},1000);

        $('#searchButton').click(() => {
            database.ref('history/').once('value', (snapshot) => {
                const data = snapshot.val();
                console.log('data', data);
                let query = $('#SearchBox').val();
                let matches = [];
                sourceList = Object.keys(data);
                for (curSide=0; curSide < sourceList.length; curSide++) {
                    let sideSources = data[sourceList[curSide]];
                    for (curSideSource = 0; curSideSource < sideSources.length; curSideSource++) {
                        let curArticles = sideSources[curSideSource].articles;
                        for (curArticle = 0; curArticle < curArticles.length; curArticle++) {
                            let curTitle = curArticles[curArticle].title;
                            let titleSplit = curTitle.split(' ');
                            for (wrd = 0; wrd < titleSplit.length; wrd++) {
                                if (query == titleSplit[wrd]) {
                                    matches.push(curTitle);
                                }
                            }
                        }
                    }
                }
                if($('#SearchBox').val().length == 0) {
                    $('#queryDisplay').html('');
                    $('#queryDisplay').css('background', 'none');
                    return;
                } else if (matches.length > 0) {
                    $('#queryDisplay').html('');
                    const qDisp = document.getElementById("queryDisplay");
                    for(i = 0; i < matches.length - 1; i++) {
                        $('#queryDisplay').html($('#queryDisplay').html() + matches[i] + '<br><br>');
                    }
                    $('#queryDisplay').html($('#queryDisplay').html() + matches[i]);
                    $('#queryDisplay').css('background-color', 'white');
                } else {
                    $('#queryDisplay').html('no matches');
                    $('#queryDisplay').css('background-color', 'white');
                }
            });
        });
    });

    $(window).scroll(function() {
        if ($(this).scrollTop() == 0) {
            $('#banner').css({
                    'box-shadow': 'none',
                    '-moz-box-shadow' : 'none',
                    '-webkit-box-shadow' : 'none' });
            $('#moreButton').css({'display': 'none'});
        }
        else {
            /*filter: drop-shadow(0px 4px 4px #3b3b3b);*/
            $('#banner').css({
                    'box-shadow': '0px 6px 8px #3b3b3b',
                    '-moz-box-shadow' : '0px 6px 8px #3b3b3b',
                    '-webkit-box-shadow' : '0px 6px 8px #3b3b3b' });
            $('#moreButton').css({'display': 'initial'});
        }
    });

    function starClick(img) {
        const id = "#" + img.id;
        if($(id).attr('src') == 'Images/hollowStar2.png') {
            $(id).attr('src', 'Images/star.png');
        } else {
            $(id).attr('src', 'Images/hollowStar2.png');
        }
    }

    function clearSearch(input) {
        const qDisp = document.getElementById('queryDisplay');
        const search = document.getElementById("SearchBox");
        if(search.value != "") {
            search.value = "";
        }
        if(input.checked != '') {
           qDisp.style.background = 'none';
           qDisp.textContent = "";
        }
        if(qDisp.textContent == "") {
            qDisp.style.background = 'none';
        }
    }

</script>

</body>

    <!-- Company Name & link on banner  -->
    <div id="topOfPage"></div>
    <div id="banner">
        <!-- input id="findBox" type="checkbox" checked='' onclick="clearSearch(this)"></input -->
        <a href="Search.html"><img id="findImg" src="Images/MagnifyingGlass.png"></img></a>
        <a href="BothSides.html" id="title"><img id="titleImg" src="Images/BothSidesTitle.png"></img></a>
        <!-- <a href="Saved.html" id="starButton"><img src="Images/star.png"></img></a> -->
        <!-- input type="search" placeholder="Search For Article.." id="searchInput" onsearch="findArticle()" -->
        <!-- <input placeholder="Search For Article.." id="SearchBox" type="text" size="20"/>
        <button id="searchButton">Go!</button>
        <div id="spacing"></div>
        <p id='queryDisplay'></p> -->
    </div>

    <center>
    <ul id="tileList">
        <li id="savedTile1" class="tile">
            <!-- <img src="Images/hollowStar2.png" class="tileStar" id="firstStar" onclick="starClick(this)"></img> -->
            <b><p class="tileHeadline" id='Headline1'>Lorem ipsum dolor sit amet, consectetur adipiscing elit incididunt ut labore et
            </p></b>
            <p class="content" id="desc1">Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
               sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
               
            <p hidden id="urlLeft1">This url should be hidden.</p>
            <p hidden id="urlRight1">This url should be hidden.</p>
            <p hidden id="urlCenter1">This url should be hidden.</p>

            <p hidden id="textLeft1">This text should be hidden.</p>
            <p hidden id="textRight1">This text should be hidden.</p>
            <p hidden id="textCenter1">This text should be hidden.</p>

            <a id="leftLink" onclick="getLeft('urlLeft1', 'textLeft1')">LEFT</a>
            <a id="centerLink" onclick="getCenter('urlCenter1', 'textCenter1')">CENTER</a>
            <a id="rightLink" onclick="getRight('urlRight1', 'textRight1')">RIGHT</a>
        </li>
        <li id="savedTile2" class="tile">
            <!-- <img src="Images/star.png" class="tileStar" id="secondStar" onclick="starClick(this)"></img> -->
            <b><p class="tileHeadline" id='Headline2'>Headline 2</p></b>

            <p class="content" id="desc2">Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
               sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>

            <p hidden id="urlLeft2">This url should be hidden.</p>
            <p hidden id="urlRight2">This url should be hidden.</p>
            <p hidden id="urlCenter2">This url should be hidden.</p>

            <p hidden id="textLeft2">This text should be hidden.</p>
            <p hidden id="textRight2">This text should be hidden.</p>
            <p hidden id="textCenter2">This text should be hidden.</p>

            <a id="leftLink" onclick="getLeft('urlLeft2', 'textLeft2')">LEFT</a>
            <a id="centerLink" onclick="getCenter('urlCenter2', 'textCenter2')">CENTER</a>
            <a id="rightLink" onclick="getRight('urlRight2', 'textRight2')">RIGHT</a>
        </li>
        <li id="savedTile3" class="tile">
            <!-- <img src="Images/hollowStar2.png" class="tileStar" id="thirdStar" onclick="starClick(this)"></img> -->
            <b><p class="tileHeadline" id='Headline3'>Headline 3</p></b>

            <p class="content" id="desc3">Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
               sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            
            <p hidden id="urlLeft3">This url should be hidden.</p>
            <p hidden id="urlRight3">This url should be hidden.</p>
            <p hidden id="urlCenter3">This url should be hidden.</p>

            <p hidden id="textLeft3">This text should be hidden.</p>
            <p hidden id="textRight3">This text should be hidden.</p>
            <p hidden id="textCenter3">This text should be hidden.</p>

            <a id="leftLink" onclick="getLeft('urlLeft3', 'textLeft3')">LEFT</a>
            <a id="centerLink" onclick="getCenter('urlCenter3', 'textCenter3')">CENTER</a>
            <a id="rightLink" onclick="getRight('urlRight3', 'textRight3')">RIGHT</a>
        </li>
        <li id="savedTile4" class="tile">
            <!-- <img src="Images/star.png" class="tileStar" id="fourthStar" onclick="starClick(this)"></img> -->
            <b><p class="tileHeadline" id='Headline4'>Headline 4</p></b>

            <p class="content" id="desc4">Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
               sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>

            <p hidden id="urlLeft4">This url should be hidden.</p>
            <p hidden id="urlRight4">This url should be hidden.</p>
            <p hidden id="urlCenter4">This url should be hidden.</p>

            <p hidden id="textLeft4">This text should be hidden.</p>
            <p hidden id="textRight4">This text should be hidden.</p>
            <p hidden id="textCenter4">This text should be hidden.</p>

            <a id="leftLink" onclick="getLeft('urlLeft4', 'textLeft4')">LEFT</a>
            <a id="centerLink" onclick="getCenter('urlCenter4', 'textCenter4')">CENTER</a>
            <a id="rightLink" onclick="getRight('urlRight4', 'textRight4')">RIGHT</a>
            
        </li>
        <li id="savedTile5" class="tile">
            <!-- <img src="Images/star.png" class="tileStar" id="fifthStar" onclick="starClick(this)"></img> -->
            <b><p class="tileHeadline" id='Headline5'>Headline 5</p></b>
            
            <p class="content" id="desc5">Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
               sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
               Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
               sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
               Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
               sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            
            <p hidden id="urlLeft5">This url should be hidden.</p>
            <p hidden id="urlRight5">This url should be hidden.</p>
            <p hidden id="urlCenter5">This url should be hidden.</p>

            <p hidden id="textLeft5">This text should be hidden.</p>
            <p hidden id="textRight5">This text should be hidden.</p>
            <p hidden id="textCenter5">This text should be hidden.</p>

            <a id="leftLink" onclick="getLeft('urlLeft5', 'textLeft5')">LEFT</a>
            <a id="centerLink" onclick="getCenter('urlCenter5', 'textCenter5')">CENTER</a>
            <a id="rightLink" onclick="getRight('urlRight5', 'textRight5')">RIGHT</a>
        </li>
    </ul>
    </center>

    <script>
        function getLeft(site, body){
            let url = document.getElementById(site).textContent;       
            let content = document.getElementById(body).textContent;

            $('#tileList').fadeOut("slow");
            $('#moreButton').fadeOut("slow");

            let doc = document.getElementById('iframe').contentWindow.document;
            doc.open();
            doc.write(content);
            doc.close();
            
            document.getElementById("articleLink").href=url;

            $(".popup").fadeIn('slow');
        }

        function getCenter(site, body){
            let url = document.getElementById(site).textContent; 
            let content = document.getElementById(body).textContent;      

            $('#tileList').fadeOut("slow");
            $('#moreButton').fadeOut("slow");

            let doc = document.getElementById('iframe').contentWindow.document;
            doc.open();
            doc.write(content);
            doc.close();
            
            document.getElementById("articleLink").href=url;

            $(".popup").fadeIn('slow');
        }

        function getRight(site, body){
            let url = document.getElementById(site).textContent;  
            let content = document.getElementById(body).textContent;     

            $('#tileList').fadeOut("slow");
            $('#moreButton').fadeOut("slow");

            let doc = document.getElementById('iframe').contentWindow.document;
            doc.open();
            doc.write(content);
            doc.close();

            document.getElementById("articleLink").href=url;
            

            $(".popup").fadeIn('slow');
        }

        function reopen(){
            $('#tileList').fadeIn("slow");
            $('#moreButton').fadeIn("slow");
        }
    </script>

    <div class="popup">
        <a id ="articleLink" href=""><button class="iframe-button">Link To Article</button></a>
        <iframe id ="iframe" src="">
            <p>Your browser does not support iframes.</p>
        </iframe>
        <a href="#" class="close" onclick="reopen()">X</a>
    </div>


</body>

<!-- More -->
<div id="moreButton">
	<a href="#">
	<img src = "Images/arrow_down.png"
	 width = "50px" height = "50px"
	 alt = "Back to Top" title = "Back to Top">
	</a>
</div>

</html>